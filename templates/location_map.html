{% extends "layout.html" %}

{% block content %}
<div class="relative h-[80vh] w-full rounded-2xl overflow-hidden shadow-2xl border border-gray-700">
    <div id="loginMap" class="h-full w-full z-0"></div>
    
    <div class="absolute top-4 left-4 z-[400] glass-card p-4 rounded-xl max-w-sm">
        <h1 class="text-lg font-bold text-white">{{ title }}</h1>
        <p class="text-xs text-gray-300 mt-1">GPS-verified login locations.</p>
        <a href="javascript:history.back()" class="mt-3 block text-center px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold rounded-lg transition-colors">Return</a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const locations = {{ login_locations|tojson|safe }};
    if (locations.length > 0) {
        const map = L.map('loginMap').setView([locations[0].lat, locations[0].lon], 10);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        locations.forEach(loc => {
            const marker = L.marker([loc.lat, loc.lon]).addTo(map);
            marker.bindPopup(
                `<div class="text-gray-900 font-sans">
                    <strong class="block mb-1">${loc.location}</strong>
                    <span class="text-xs text-gray-600">${new Date(loc.time * 1000).toLocaleString()}</span><br>
                    <span class="text-xs font-mono">${loc.ip}</span>
                </div>`
            );
        });
    } else {
        document.getElementById('loginMap').innerHTML = '<div class="flex items-center justify-center h-full text-gray-400 bg-gray-900">No location data available.</div>';
    }
});
</script>
{% endblock %}